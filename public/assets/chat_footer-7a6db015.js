import{L as w,t as _,p as C,l as x,o as g,q as f,k as m,_ as y,$ as T}from"./vue-8b21a996.js";import{c as l}from"./chat-44476ac1.js";import{c as I,_ as b,a as h}from"./index-36779712.js";import"./userChat-b1a939a4.js";const z="/api/chat/";function D(c,t,r){I({url:z+"sendMsg",method:"post",data:c,responseType:"stream",onDownloadProgress:function(i){let e="Client error",o="页面错误",n=i.event.currentTarget.responseText;n.includes(e)||n.includes(o)?l.updateChatMsg(t,r-1,"msg","AI机器人有点忙，请稍后发送"):l.updateChatMsg(t,r-1,"msg",i.event.currentTarget.responseText)}})}const V={class:"chat_submit"},k={class:"chat_submit-01"},N={__name:"chat_footer",setup(c){let t=w(""),r=async i=>{i.preventDefault();let e=h().getUserInfo(),o=l.getNowChatId();if(t.value==null||t.value=="")return!1;if(e.num<=0){let a="";return e.id==0?a="聊天次数不足,请登录账号":a="聊天次数不足,请开通会员",l.updateChat(o,{role:"robot",msg:a,time:new Date().getTime(),size:10,iswrite:!1}),!1}l.updateChat(o,{role:"user",msg:t.value,time:new Date().getTime(),size:10});let n=0;n=l.updateChat(o,{role:"robot",msg:"思考中...",time:new Date().getTime(),size:10,iswrite:!1}),t.value,t.value="";let s=l.getOneChat(o),d=[],p=0;s.msglist.length>10&&(p=s.msglist.length-11);for(let a=0;a<s.msglist.length-1;a++){if(a<p)continue;let u=s.msglist[a].role;u=="robot"?u="assistant":u="user",d.push({role:u,content:s.msglist[a].msg})}await D({message:d,uid:e.id,username:e.username,num:e.num-1},o,n);let v=e.num-1;h().setNum(v)};return(i,e)=>{const o=_("el-input"),n=_("Icon");return C(),x("div",V,[g("div",k,[f(o,{autosize:"",type:"textarea",modelValue:m(t),"onUpdate:modelValue":e[0]||(e[0]=s=>y(t)?t.value=s:t=s),onKeydown:T(m(r),["enter"]),placeholder:"来说点什么吧..."},null,8,["modelValue","onKeydown"]),g("div",{class:"chat-send-msg",onClick:e[1]||(e[1]=(...s)=>m(r)&&m(r)(...s))},[f(n,{name:"el-icon-Promotion",size:"20"})])])])}}},M=b(N,[["__scopeId","data-v-9ede0f26"]]);export{M as default};
