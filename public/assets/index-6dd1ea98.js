var b=Object.defineProperty;var g=(o,e,a)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[e]=a;var s=(o,e,a)=>(g(o,typeof e!="symbol"?e+"":e,a),a);import{defineComponent as u,ref as f,provide as y,onMounted as _,resolveComponent as x,openBlock as c,createElementBlock as k,unref as n,createBlock as v,createCommentVNode as D,createVNode as d}from"vue";import{b as L,T as F,a as R}from"./index-0a827c2c.js";import{c as q,i as m,aD as w,an as E,aB as z}from"./index-89e26330.js";import{f as p}from"./controllerUrls-941681c3.js";import S from"./popupForm-41630086.js";import{useI18n as T}from"vue-i18n";import"element-plus";import"vue-router";import"./index-d3b20950.js";import"pinia";import"vue-demi";import"./index-39d73c69.js";import"./validate-e09b6b50.js";function I(){return q({url:p+"add",method:"get"})}class C extends L{constructor(a,t,r={},i={},l={}){super(a,t,r,i,l);s(this,"requestEdit",a=>(this.runBefore("requestEdit",{id:a}),this.form.loading=!0,this.form.items={},this.api.edit({id:a}).then(t=>{const r=[],i=[];for(const l in t.data.row.data_fields)r.push(l),i.push({name:l,value:t.data.row.data_fields[l]??""});this.form.extend=Object.assign(this.form.extend,{tableList:t.data.tables,controllerList:t.data.controllers}),t.data.row.data_table&&(this.onTableChange(t.data.row.data_table),this.form.extend.parentRef&&this.form.extend.parentRef.setDataFields(i)),t.data.row.data_fields=r,this.form.loading=!1,this.form.items=t.data.row,this.runAfter("requestEdit",{res:t})})));s(this,"onTableChange",a=>{this.form.extend=Object.assign(this.form.extend,{fieldLoading:!0,fieldList:{},fieldSelect:{},fieldSelectKey:m()}),this.form.items.data_fields=[],this.form.extend.parentRef&&this.form.extend.parentRef.setDataFields([]),w(a).then(t=>{this.form.items.primary_key=t.data.pk,this.form.defaultItems.primary_key=t.data.pk;const r={};for(const i in t.data.fieldList)r[i]=(i?i+" - ":"")+t.data.fieldList[i];this.form.extend=Object.assign(this.form.extend,{fieldLoading:!1,fieldList:t.data.fieldList,fieldSelect:r,fieldSelectKey:m()})})});s(this,"toggleForm",(a="",t=[])=>{if(this.runBefore("toggleForm",{operate:a,operateIds:t}),this.form.ref&&this.form.ref.resetFields(),this.form.extend.parentRef&&this.form.extend.parentRef.setDataFields([]),a=="edit"){if(!t.length)return!1;this.requestEdit(t[0])}else a=="add"&&(this.form.loading=!0,I().then(r=>{this.form.extend=Object.assign(this.form.extend,{tableList:r.data.tables,controllerList:r.data.controllers}),this.form.items=Object.assign({},this.form.defaultItems),this.form.loading=!1}));this.form.operate=a,this.form.operateIds=t,this.runAfter("toggleForm",{operate:a,operateIds:t})})}}const K={class:"default-main ba-table-box"},P=u({name:"security/dataRecycle"}),Y=u({...P,setup(o){const{t:e}=T(),a=f(),t=f(),r=new C(new E(p),{column:[{type:"selection",align:"center",operator:!1},{label:"ID",prop:"id",align:"center",operator:"LIKE",operatorPlaceholder:e("Fuzzy query"),width:70},{label:e("security.sensitiveData.Rule name"),prop:"name",align:"center",operator:"LIKE",operatorPlaceholder:e("Fuzzy query")},{label:e("security.sensitiveData.controller"),prop:"controller",align:"center",operator:"LIKE",operatorPlaceholder:e("Fuzzy query")},{label:e("security.sensitiveData.data sheet"),prop:"data_table",align:"center",operator:"LIKE",operatorPlaceholder:e("Fuzzy query")},{label:e("security.sensitiveData.Data table primary key"),prop:"primary_key",align:"center",operator:"LIKE",operatorPlaceholder:e("Fuzzy query"),width:100},{label:e("security.sensitiveData.Sensitive fields"),prop:"data_fields",align:"center",operator:"LIKE",operatorPlaceholder:e("Fuzzy query"),render:"tags"},{label:e("state"),prop:"status",align:"center",render:"tag",custom:{0:"danger",1:"success"},replaceValue:{0:e("Disable"),1:e("security.sensitiveData.Modifying monitoring")}},{label:e("updatetime"),prop:"updatetime",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:e("createtime"),prop:"createtime",align:"center",render:"datetime",sortable:"custom",operator:"RANGE",width:160},{label:e("operate"),align:"center",width:"130",render:"buttons",buttons:z(["edit","delete"]),operator:!1}],dblClickNotEditColumn:[void 0]},{defaultItems:{status:"1"}},{onSubmit:()=>{r.form.items.fields=t.value.getDataFields()}});return y("baTable",r),_(()=>{r.form.extend=Object.assign({},r.form.extend,{parentRef:t.value}),r.table.ref=a.value,r.mount(),r.getIndex()}),(i,l)=>{const h=x("el-alert");return c(),k("div",K,[n(r).table.remark?(c(),v(h,{key:0,class:"ba-table-alert",title:n(r).table.remark,type:"info","show-icon":""},null,8,["title"])):D("",!0),d(F,{buttons:["refresh","add","edit","delete","comSearch","quickSearch","columnDisplay"],"quick-search-placeholder":n(e)("quick Search Placeholder",{fields:n(e)("security.sensitiveData.controller")})},null,8,["quick-search-placeholder"]),d(R,{ref_key:"tableRef",ref:a},null,512),d(S,{ref_key:"formRef",ref:t},null,512)])}}});export{Y as default};
