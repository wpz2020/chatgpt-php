import{defineComponent as S,ref as y,reactive as D,onMounted as L,watch as B,resolveComponent as k,openBlock as l,createElementBlock as n,createVNode as c,unref as e,withCtx as F,createElementVNode as o,Fragment as H,renderList as N,toDisplayString as C,withDirectives as z,vShow as P,createCommentVNode as m}from"vue";import{a as $}from"./chat-5c60e301.js";import{storeToRefs as x}from"pinia";import{u as U}from"./chat-9567bdf0.js";import{t as b}from"./timeToDate-4f013b84.js";import{ElScrollbar as j}from"element-plus";import{b as q,m as _,_ as A}from"./index-89e26330.js";import{s as G}from"./sendMsg-ed7afb93.js";import{x as w}from"./chat-3c5e52ec.js";import"vue-i18n";import"vue-router";import"vue-demi";import"./chat-57a81274.js";const J={class:"chat-content-body"},K={key:0},O=["index"],Q={key:0,class:"chat_left"},W={class:"user-avatr"},X={class:"user-avatr-time"},Y={class:"chat-speak"},Z={class:"chat-speak-01"},ee={class:"dh_action"},te={key:1,class:"chat_right"},se={class:"user-avatr"},oe={class:"user-avatr-time"},re={class:"chat-speak"},ae=S({__name:"chat",setup(ce){const u="preview-only",h=y(),p=y();let T=q(),I=U(),{chatMsgList:i,nowChatId:d}=x(I);const{avatar:V}=x(T);function f(){let s=h.value.clientHeight;p.value.setScrollTop(s+500)}const v=s=>`${s}`;let M=s=>{navigator.clipboard.writeText(s).then(()=>{_.success("复制成功")}).catch(r=>{var t=document.createElement("textarea");t.value=s,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),_.success("复制成功")})},R=()=>{_.success("重新发送中");let r=i.value[d.value].msglist;for(let t=0;t<r.length;t++)if(r[r.length-t-1].role=="user"){G(r[r.length-t-1].msg,"refresh");break}};return D({output:"",isEnd:!1,speed:80,singleBack:!1,sleep:0,type:"normal",backSpeed:40,sentencePause:!1}),L(()=>{f()}),B(i,(s,r)=>{setTimeout(()=>{f()},100)},{deep:!0}),(s,r)=>{const t=k("el-avatar"),g=k("Icon");return l(),n("div",J,[c(e(j),{ref_key:"scrollbarRef",ref:p,style:{overflow:"hidden"},class:"infinite-list chat-content-scroll",always:""},{default:F(()=>[o("div",{ref_key:"innerRef",ref:h},[e(i)[e(d)]?(l(),n("div",K,[(l(!0),n(H,null,N(e(i)[e(d)].msglist,(a,E)=>(l(),n("div",{index:E,class:"scrollbar-demo-item"},[a.role!="user"?(l(),n("div",Q,[o("div",W,[c(t,{src:e($)},null,8,["src"]),o("span",X,C(e(b).setTime(a.time)),1)]),o("div",Y,[o("div",Z,[c(e(w),{previewTheme:"vuepress",formatCopiedText:v,editorId:u,modelValue:a.msg},null,8,["modelValue"]),z(o("div",ee,[c(g,{name:"el-icon-CopyDocument",onClick:le=>e(M)(a.msg),title:"复制",color:"#8595F4",size:"20"},null,8,["onClick"]),c(g,{name:"el-icon-Refresh",onClick:e(R),title:"重试",color:"#8595F4",size:"20"},null,8,["onClick"])],512),[[P,a.isfinish]])])])])):m("",!0),a.role=="user"?(l(),n("div",te,[o("div",se,[c(t,{src:e(V)},null,8,["src"]),o("span",oe,C(e(b).setTime(a.time)),1)]),o("div",re,[c(e(w),{previewTheme:"vuepress",formatCopiedText:v,editorId:u,modelValue:a.msg},null,8,["modelValue"])])])):m("",!0)],8,O))),256))])):m("",!0)],512)]),_:1},512)])}}});const Ce=A(ae,[["__scopeId","data-v-627d1303"]]);export{Ce as default};
