import{defineComponent as re,ref as F,reactive as R,watchEffect as le,onMounted as ne,onUnmounted as ie,resolveComponent as m,openBlock as f,createBlock as w,unref as i,withCtx as a,createElementVNode as D,createVNode as t,createElementBlock as h,withKeys as B,createCommentVNode as y,createTextVNode as _,toDisplayString as C,isRef as K}from"vue";import{b as se,u as de,i as A,n as ue,o as j,k as me,p as fe,q as ce,t as pe,v as ge,w as G,x as H,_ as ve}from"./index-89e26330.js";import{u as we}from"./memberCenter-893be883.js";import{useI18n as _e}from"vue-i18n";import{b as c,v as be}from"./validate-e09b6b50.js";import{useRoute as he,useRouter as ye}from"vue-router";import{l as Ce,L as Ve}from"./loginFooter-088178d1.js";import{u as ke}from"./menu-c85258cb.js";import{h as ze}from"./router-fdf560e7.js";import"pinia";import"vue-demi";import"element-plus";const Le={class:"login chat-login"},xe={key:0},Fe={key:0,class:"login-box"},Pe=["src"],Se={key:3,class:"form-footer"},Re={key:1,class:"retrieve-password-form"},Te=re({__name:"login",setup(Ie){let P=ke(),T;const{t:n}=_e(),J=he();ye();const V=se(),I=de(),U=we(),b=F(),k=F(),e=R({form:{tab:"login",email:"",mobile:"",username:"",password:"",captcha:"",keep:!1,captchaId:A(),registerType:"mobile"},formLoading:!1,showCaptcha:!1,showRetrievePasswordDialog:!1,retrievePasswordForm:{type:"mobile",account:"",captcha:"",password:""},dialogWidth:30,accountVerificationType:[],codeSendCountdown:0,submitRetrieveLoading:!1,sendCaptchaLoading:!1});let p=F(!1),z=F("用户登录");le(()=>{p.value?z.value="忘记密码":e.form.tab=="register"?z.value="用户注册":z.value="用户登录"});const O=R({email:[c({name:"required",title:n("email")}),c({name:"email",title:n("email")})],username:[c({name:"required",title:n("User name")}),{validator:(l,o,s)=>{if(e.form.tab=="register")return be(l,o,s);s()},trigger:"blur"}],password:[c({name:"required",title:n("password")}),c({name:"password"})],mobile:[c({name:"required",title:n("mobile")}),c({name:"mobile"})]}),Q=R({account:[c({name:"required",title:n("Account name")})],captcha:[c({name:"required",title:n("Verification Code")})],password:[c({name:"required",title:n("password")}),c({name:"password"})]}),$=()=>{let l=document.documentElement.clientWidth,o=30;l<=790?o=92:l<=910?o=56:l<=1260&&(o=46),e.dialogWidth=o},L=()=>{e.form.captcha="",e.form.captchaId=A()},q=(l=void 0)=>{l.validate(o=>{o?(e.formLoading=!0,e.form.tab=="register"&&e.form.username==""&&(e.form.username="user"+fe(1e3,9999).toString()),j("post",e.form).then(s=>(console.log(),P.userLogin=!1,e.formLoading=!1,V.dataFill(s.data.userInfo),U.state.viewRoutes.length==0&&ce().then(d=>{d.data.userInfo.refreshToken=V.refreshToken,V.dataFill(d.data.userInfo),d.data.menus&&ze(d.data.menus)}),!1)).catch(()=>{e.formLoading=!1,L()})):L()})},M=(l=void 0)=>{l.validate(o=>{o&&(e.submitRetrieveLoading=!0,pe(e.retrievePasswordForm).then(s=>{e.submitRetrieveLoading=!1,s.code==1&&(e.showRetrievePasswordDialog=!1,L(),S(),ge(l))}).catch(()=>{e.submitRetrieveLoading=!1}))})},X=(l=void 0)=>{e.codeSendCountdown>0||l.validateField([e.form.registerType,"username","password"]).then(o=>{o&&(e.sendCaptchaLoading=!0,(e.form.registerType=="email"?G:H)(e.form[e.form.registerType],"user_register").then(u=>{u.code==1&&N(60)}).finally(()=>{e.sendCaptchaLoading=!1}))})},Y=(l=void 0)=>{e.codeSendCountdown>0||l.validateField("account").then(o=>{o&&(e.sendCaptchaLoading=!0,(e.retrievePasswordForm.type=="email"?G:H)(e.retrievePasswordForm.account,"user_retrieve_pwd").then(u=>{u.code==1&&N(60)}).finally(()=>{e.sendCaptchaLoading=!1}))})},E=(l=void 0,o)=>{e.form.tab=o,o=="register"&&(e.form.username=""),l&&l.clearValidate()},N=l=>{e.codeSendCountdown=l,T=setInterval(()=>{e.codeSendCountdown--,e.codeSendCountdown<=0&&S()},1e3)},S=()=>{e.codeSendCountdown=0,clearInterval(T)};return ne(async()=>{await Ce()||($(),ue(window,"resize",$),V.$state.id==0&&j("get").then(l=>{e.accountVerificationType=l.data.accountVerificationType,e.retrievePasswordForm.type=l.data.accountVerificationType.length>0?l.data.accountVerificationType[0]:""}),J.query.type=="register"&&(e.form.tab="register"))}),ie(()=>{e.codeSendCountdown=0,S()}),(l,o)=>{const s=m("Icon"),u=m("el-input"),d=m("el-form-item"),g=m("el-col"),x=m("el-row"),v=m("el-button"),Z=m("el-checkbox"),W=m("el-form"),ee=m("el-alert"),oe=m("el-main"),te=m("el-container"),ae=m("el-dialog");return f(),w(ae,{modelValue:i(P).userLogin,"onUpdate:modelValue":o[18]||(o[18]=r=>i(P).userLogin=r),title:i(z),width:e.dialogWidth+"%",center:"","align-center":"",draggable:"",class:"user-login-header"},{default:a(()=>[D("div",Le,[t(te,{class:"is-vertical"},{default:a(()=>[t(oe,{class:"frontend-footer-brother"},{default:a(()=>[t(x,{justify:"center"},{default:a(()=>[t(g,{span:16,xs:24},{default:a(()=>[i(p)?(f(),h("div",Re,[t(W,{ref_key:"retrieveFormRef",ref:k,onKeyup:o[17]||(o[17]=B(r=>M(k.value),["enter"])),rules:Q,model:e.retrievePasswordForm,"label-width":100},{default:a(()=>[t(d,{prop:"account","label-width":"0"},{default:a(()=>[t(u,{modelValue:e.retrievePasswordForm.account,"onUpdate:modelValue":o[11]||(o[11]=r=>e.retrievePasswordForm.account=r),placeholder:i(n)("Please input field",{field:e.retrievePasswordForm.type=="email"?i(n)("email"):i(n)("mobile")}),size:"large",clearable:!0},{prefix:a(()=>[t(s,{name:"fa fa-user",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(d,{prop:"password","label-width":"0"},{default:a(()=>[t(u,{modelValue:e.retrievePasswordForm.password,"onUpdate:modelValue":o[12]||(o[12]=r=>e.retrievePasswordForm.password=r),placeholder:i(n)("Please input field",{field:i(n)("New password")}),"show-password":"",size:"large"},{prefix:a(()=>[t(s,{name:"fa fa-unlock-alt",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(d,{prop:"captcha","label-width":"0"},{default:a(()=>[t(x,{class:"w100"},{default:a(()=>[t(g,{span:16},{default:a(()=>[t(u,{modelValue:e.retrievePasswordForm.captcha,"onUpdate:modelValue":o[13]||(o[13]=r=>e.retrievePasswordForm.captcha=r),placeholder:i(n)("Please input field",{field:i(n)("Verification Code")}),autocomplete:"off",size:"large"},{prefix:a(()=>[t(s,{name:"fa fa-ellipsis-h",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue","placeholder"])]),_:1}),t(g,{class:"captcha-box",span:8},{default:a(()=>[t(v,{onClick:o[14]||(o[14]=r=>Y(k.value)),loading:e.sendCaptchaLoading,disabled:!(e.codeSendCountdown<=0),type:"primary"},{default:a(()=>[_(C(e.codeSendCountdown<=0?i(n)("send"):e.codeSendCountdown+i(n)("seconds")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),t(d,{class:"form-buttons","label-width":"0"},{default:a(()=>[t(v,{class:"login-btn",onClick:o[15]||(o[15]=r=>M(k.value)),loading:e.submitRetrieveLoading,round:"",type:"primary",size:"large"},{default:a(()=>[_(C(i(n)("second")),1)]),_:1},8,["loading"]),t(v,{onClick:o[16]||(o[16]=r=>K(p)?p.value=!1:p=!1),round:"",plain:"",type:"info",size:"large"},{default:a(()=>[_(" 返回登录 ")]),_:1})]),_:1})]),_:1},8,["rules","model"])])):(f(),h("div",xe,[i(U).state.open?(f(),h("div",Fe,[t(W,{ref_key:"formRef",ref:b,onKeyup:o[10]||(o[10]=B(r=>q(b.value),["enter"])),rules:O,model:e.form},{default:a(()=>[e.form.registerType=="mobile"?(f(),w(d,{key:0,prop:"mobile"},{default:a(()=>[t(u,{modelValue:e.form.mobile,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.mobile=r),placeholder:"请输入手机号",clearable:!0,size:"large"},{prefix:a(()=>[t(s,{name:"fa fa-tablet",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1})):y("",!0),t(d,{prop:"password"},{default:a(()=>[t(u,{modelValue:e.form.password,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.password=r),placeholder:"请输入用户密码",type:"password","show-password":"",size:"large"},{prefix:a(()=>[t(s,{name:"fa fa-unlock-alt",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1}),e.form.tab=="login"&&i(I).loginCheck=="true"?(f(),w(d,{key:1,prop:"captcha"},{default:a(()=>[t(x,{class:"w100"},{default:a(()=>[t(g,{span:16},{default:a(()=>[t(u,{modelValue:e.form.captcha,"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.captcha=r),clearable:"",autocomplete:"off",placeholder:"请输入验证码",size:"large"},{prefix:a(()=>[t(s,{name:"fa fa-ellipsis-h",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1}),t(g,{class:"captcha-box",span:8},{default:a(()=>[D("img",{onClick:L,class:"captcha-img",src:i(me)()+"&id="+e.form.captchaId,alt:""},null,8,Pe)]),_:1})]),_:1})]),_:1})):y("",!0),e.form.tab=="register"&&i(I).openCheck=="true"?(f(),w(d,{key:2,prop:"captcha"},{default:a(()=>[t(x,{class:"w100"},{default:a(()=>[t(g,{span:16},{default:a(()=>[t(u,{size:"large",modelValue:e.form.captcha,"onUpdate:modelValue":o[3]||(o[3]=r=>e.form.captcha=r),placeholder:"请输入验证码",autocomplete:"off"},{prefix:a(()=>[t(s,{name:"fa fa-ellipsis-h",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1}),t(g,{class:"captcha-box",span:8},{default:a(()=>[t(v,{size:"large",onClick:o[4]||(o[4]=r=>X(b.value)),loading:e.sendCaptchaLoading,disabled:!(e.codeSendCountdown<=0),type:"primary"},{default:a(()=>[_(C(e.codeSendCountdown<=0?"发送":e.codeSendCountdown+"秒"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})):y("",!0),e.form.tab!="register"?(f(),h("div",Se,[t(Z,{modelValue:e.form.keep,"onUpdate:modelValue":o[5]||(o[5]=r=>e.form.keep=r),label:"记住我",size:"default"},null,8,["modelValue"]),e.accountVerificationType.length>0?(f(),h("div",{key:0,onClick:o[6]||(o[6]=r=>K(p)?p.value=!0:p=!0),class:"forgot-password"},C(i(n)("Forgot your password?")),1)):y("",!0)])):y("",!0),t(d,{class:"form-buttons"},{default:a(()=>[t(v,{class:"login-btn",onClick:o[7]||(o[7]=r=>q(b.value)),loading:e.formLoading,round:"",type:"primary",size:"large"},{default:a(()=>[_(C(i(n)(e.form.tab)),1)]),_:1},8,["loading"]),e.form.tab=="register"?(f(),w(v,{key:0,onClick:o[8]||(o[8]=r=>E(b.value,"login")),round:"",plain:"",type:"info",size:"large"},{default:a(()=>[_("回到登录")]),_:1})):(f(),w(v,{key:1,onClick:o[9]||(o[9]=r=>E(b.value,"register")),round:"",plain:"",type:"info",size:"large"},{default:a(()=>[_(" 还没有账户？点击注册 ")]),_:1}))]),_:1}),t(Ve)]),_:1},8,["rules","model"])])):(f(),w(ee,{key:1,center:!0,title:l.$t("Member center disabled"),type:"error"},null,8,["title"]))]))]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue","title","width"])}}});const Ge=ve(Te,[["__scopeId","data-v-a9db1f56"]]);export{Ge as default};
