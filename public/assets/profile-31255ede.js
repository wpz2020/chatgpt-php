import{openBlock as p,createElementBlock as S,defineComponent as X,ref as T,reactive as Y,onMounted as Z,resolveComponent as g,resolveDirective as E,createVNode as n,withCtx as r,createElementVNode as w,toDisplayString as u,withDirectives as q,createBlock as b,unref as t,createTextVNode as f,withKeys as F,createCommentVNode as V,normalizeStyle as K}from"vue";import{useRouter as x}from"vue-router";import{F as c}from"./index-39d73c69.js";import{_ as G,b as ee,ax as oe,v as le,w as z,x as O,ay as ae,az as ie,aA as te}from"./index-89e26330.js";import{b as s}from"./validate-e09b6b50.js";import{useI18n as ne}from"vue-i18n";import"./index-0a827c2c.js";import"element-plus";import"./controllerUrls-941681c3.js";import"./index-d3b20950.js";import"pinia";import"vue-demi";const re={};function de(j,_){return p(),S("div")}const ue=G(re,[["render",de]]),se={class:"user-views"},pe={class:"card-header"},fe={class:"user-profile"},ce={key:0},me={key:1},ge=X({__name:"profile",setup(j){let _;const{t:l}=ne(),H=x(),y=ee(),C=T(),h=T(),$=T(),e=Y({formSubmitLoading:!1,form:y.$state,rules:{avatar:[s({name:"required",message:l("Please select field",{field:l("user.account.profile.head portrait")})})],username:[s({name:"required",title:l("user.account.profile.User name")}),s({name:"account"})],nickname:[s({name:"required",title:l("user.account.profile.nickname")})]},accountVerificationType:[],dialog:{type:"email",submitLoading:!1,sendCaptchaLoading:!1,codeSendCountdown:0,verification:{show:!1,rules:{password:[s({name:"required",title:l("user.account.profile.password")}),s({name:"password"})],captcha:[s({name:"required",title:l("user.account.profile.Verification Code")})]},form:{password:"",captcha:""},accountVerificationToken:""},bind:{show:!1,rules:{password:[s({name:"required",title:l("user.account.profile.password")}),s({name:"password"})],email:[s({name:"required",title:l("user.account.profile.email")}),s({name:"email",title:l("user.account.profile.email")})],mobile:[s({name:"required",title:l("user.account.profile.mobile")}),s({name:"mobile",title:l("user.account.profile.mobile")})],captcha:[s({name:"required",title:l("user.account.profile.Verification Code")})]},form:{password:"",email:"",mobile:"",captcha:""}}}}),R=a=>{e.dialog.codeSendCountdown=a,_=setInterval(()=>{e.dialog.codeSendCountdown--,e.dialog.codeSendCountdown<=0&&U()},1e3)},U=()=>{e.dialog.codeSendCountdown=0,clearInterval(_)},I=a=>{a=="email"&&y.email||a=="mobile"&&y.mobile?e.dialog.verification.show=!0:e.dialog.bind.show=!0,e.dialog.type=a},J=a=>{a&&(e.dialog.codeSendCountdown>0||a.validateField("password").then(o=>{o&&(e.dialog.sendCaptchaLoading=!0,(e.dialog.type=="email"?z:O)(y[e.dialog.type],`user_${e.dialog.type}_verify`,{password:e.dialog.verification.form.password}).then(m=>{m.code==1&&R(60)}).finally(()=>{e.dialog.sendCaptchaLoading=!1}))}))},Q=a=>{a&&(e.dialog.codeSendCountdown>0||a.validateField(e.dialog.type).then(o=>{o&&(e.dialog.sendCaptchaLoading=!0,(e.dialog.type=="email"?z:O)(e.dialog.bind.form[e.dialog.type],`user_change_${e.dialog.type}`).then(m=>{m.code==1&&R(60)}).finally(()=>{e.dialog.sendCaptchaLoading=!1}))}))},M=a=>{a&&a.validate(o=>{o&&(e.dialog.submitLoading=!0,ae({type:e.dialog.type,captcha:e.dialog.verification.form.captcha}).then(d=>{U(),e.dialog.bind.show=!0,e.dialog.type=d.data.type,e.dialog.verification.show=!1,e.dialog.verification.accountVerificationToken=d.data.accountVerificationToken}).finally(()=>{e.dialog.submitLoading=!1}))})},N=a=>{a&&a.validate(o=>{o&&(e.dialog.submitLoading=!0,ie({type:e.dialog.type,accountVerificationToken:e.dialog.verification.accountVerificationToken,...e.dialog.bind.form}).then(()=>{U(),e.dialog.bind.show=!1,y[e.dialog.type]=e.dialog.bind.form[e.dialog.type]}).finally(()=>{e.dialog.submitLoading=!1}))})},B=a=>{a&&a.validate(o=>{o&&(e.formSubmitLoading=!0,te(e.form).then(()=>{e.formSubmitLoading=!1}).catch(()=>{e.formSubmitLoading=!1}))})};return Z(()=>{oe().then(a=>{e.accountVerificationType=a.data.accountVerificationType})}),(a,o)=>{const d=g("el-button"),m=g("el-input"),v=g("el-form-item"),L=g("el-form"),W=g("el-card"),k=g("el-col"),A=g("el-row"),D=g("el-dialog"),P=E("blur");return p(),S("div",se,[n(W,{class:"user-views-card",shadow:"hover"},{header:r(()=>[w("div",pe,[w("span",null,u(a.$t("user.account.profile.personal data")),1),q((p(),b(d,{onClick:o[0]||(o[0]=i=>t(H).push({name:"account/changePassword"})),type:"info",plain:""},{default:r(()=>[f(u(a.$t("user.account.profile.Change Password")),1)]),_:1})),[[P]])])]),default:r(()=>[w("div",fe,[n(L,{model:e.form,rules:e.rules,"label-width":100,ref_key:"formRef",ref:C,onKeyup:o[13]||(o[13]=F(i=>B(C.value),["enter"]))},{default:r(()=>[n(c,{label:a.$t("user.account.profile.head portrait"),"input-attr":{"hide-select-file":!0},type:"image",modelValue:e.form.avatar,"onUpdate:modelValue":o[1]||(o[1]=i=>e.form.avatar=i),prop:"avatar"},null,8,["label","modelValue"]),n(c,{label:a.$t("user.account.profile.User name"),type:"string",modelValue:e.form.username,"onUpdate:modelValue":o[2]||(o[2]=i=>e.form.username=i),placeholder:a.$t("Please input field",{field:a.$t("user.account.profile.User name")}),prop:"username"},null,8,["label","modelValue","placeholder"]),n(c,{label:a.$t("user.account.profile.User nickname"),type:"string",modelValue:e.form.nickname,"onUpdate:modelValue":o[3]||(o[3]=i=>e.form.nickname=i),placeholder:a.$t("Please input field",{field:a.$t("user.account.profile.User nickname")}),prop:"nickname"},null,8,["label","modelValue","placeholder"]),e.accountVerificationType.includes("email")?(p(),b(v,{key:0,label:t(l)("user.account.profile.email")},{default:r(()=>[n(m,{modelValue:e.form.email,"onUpdate:modelValue":o[5]||(o[5]=i=>e.form.email=i),readonly:"",placeholder:t(l)("user.account.profile.Operation via right button")},{append:r(()=>[n(d,{type:"primary",onClick:o[4]||(o[4]=i=>I("email"))},{default:r(()=>[f(u(e.form.email?t(l)("user.account.profile.Click Modify"):t(l)("user.account.profile.bind")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):V("",!0),e.accountVerificationType.includes("mobile")?(p(),b(v,{key:1,label:t(l)("user.account.profile.mobile")},{default:r(()=>[n(m,{modelValue:e.form.mobile,"onUpdate:modelValue":o[7]||(o[7]=i=>e.form.mobile=i),readonly:"",placeholder:t(l)("user.account.profile.Operation via right button")},{append:r(()=>[n(d,{type:"primary",onClick:o[6]||(o[6]=i=>I("mobile"))},{default:r(()=>[f(u(e.form.mobile?t(l)("user.account.profile.Click Modify"):t(l)("user.account.profile.bind")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):V("",!0),n(c,{label:a.$t("user.account.profile.Gender"),type:"radio",modelValue:e.form.gender,"onUpdate:modelValue":o[8]||(o[8]=i=>e.form.gender=i),data:{childrenAttr:{border:!0},content:{0:a.$t("user.account.profile.secrecy"),1:a.$t("user.account.profile.male"),2:a.$t("user.account.profile.female")}}},null,8,["label","modelValue","data"]),n(c,{label:a.$t("user.account.profile.birthday"),type:"date",modelValue:e.form.birthday,"onUpdate:modelValue":o[9]||(o[9]=i=>e.form.birthday=i)},null,8,["label","modelValue"]),n(c,{label:a.$t("user.account.profile.Personal signature"),type:"textarea",placeholder:a.$t("Please input field",{field:a.$t("user.account.profile.Personal signature")}),modelValue:e.form.motto,"onUpdate:modelValue":o[10]||(o[10]=i=>e.form.motto=i),"input-attr":{"show-word-limit":!0,rows:3}},null,8,["label","placeholder","modelValue"]),n(ue),n(v,{class:"submit-buttons"},{default:r(()=>[n(d,{onClick:o[11]||(o[11]=i=>t(le)(C.value))},{default:r(()=>[f(u(a.$t("Reset")),1)]),_:1}),n(d,{type:"primary",loading:e.formSubmitLoading,onClick:o[12]||(o[12]=i=>B(C.value))},{default:r(()=>[f(u(a.$t("Save")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])]),_:1}),n(D,{title:t(l)("user.account.profile.Account verification"),modelValue:e.dialog.verification.show,"onUpdate:modelValue":o[20]||(o[20]=i=>e.dialog.verification.show=i),class:"ba-change-bind-dialog ba-verification-dialog","destroy-on-close":!0,"close-on-click-modal":!1,width:"30%"},{footer:r(()=>[w("div",{style:K("width: calc(100% - 20px)")},[n(d,{onClick:o[18]||(o[18]=i=>e.dialog.verification.show=!1)},{default:r(()=>[f(u(t(l)("Cancel")),1)]),_:1}),q((p(),b(d,{loading:e.dialog.submitLoading,onClick:o[19]||(o[19]=i=>M($.value)),type:"primary"},{default:r(()=>[f(u(t(l)("user.account.profile.next step")),1)]),_:1},8,["loading"])),[[P]])],4)]),default:r(()=>[n(L,{model:e.dialog.verification.form,rules:e.dialog.verification.rules,"label-position":"top",ref_key:"verificationFormRef",ref:$,onKeyup:o[17]||(o[17]=F(i=>M($.value),["enter"]))},{default:r(()=>[n(c,{label:t(l)("user.account.profile.Account password verification"),type:"password",modelValue:e.dialog.verification.form.password,"onUpdate:modelValue":o[14]||(o[14]=i=>e.dialog.verification.form.password=i),prop:"password","input-attr":{"show-password":!0},placeholder:a.$t("Please input field",{field:a.$t("user.account.profile.password")})},null,8,["label","modelValue","placeholder"]),n(v,{prop:"captcha"},{label:r(()=>[e.dialog.type=="email"?(p(),S("span",ce,u(t(l)("user.account.profile.Mail verification"))+" ("+u(t(l)("user.account.profile.accept")+t(l)("user.account.profile.mail")+"："+t(y).email)+") ",1)):(p(),S("span",me,u(t(l)("user.account.profile.SMS verification"))+" ("+u(t(l)("user.account.profile.accept")+t(l)("user.account.profile.mobile")+"："+t(y).mobile)+") ",1))]),default:r(()=>[n(A,{class:"w100",gutter:10},{default:r(()=>[n(k,{span:18},{default:r(()=>[n(m,{modelValue:e.dialog.verification.form.captcha,"onUpdate:modelValue":o[15]||(o[15]=i=>e.dialog.verification.form.captcha=i),placeholder:t(l)("Please input field",{field:t(l)("user.account.profile.Verification Code")}),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),n(k,{class:"captcha-box",span:6},{default:r(()=>[n(d,{onClick:o[16]||(o[16]=i=>J($.value)),loading:e.dialog.sendCaptchaLoading,disabled:!(e.dialog.codeSendCountdown<=0),type:"primary"},{default:r(()=>[f(u(e.dialog.codeSendCountdown<=0?t(l)("user.account.profile.send"):e.dialog.codeSendCountdown+t(l)("user.account.profile.seconds")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),n(D,{title:t(l)("user.account.profile.bind")+t(l)("user.account.profile."+e.dialog.type),modelValue:e.dialog.bind.show,"onUpdate:modelValue":o[29]||(o[29]=i=>e.dialog.bind.show=i),class:"ba-change-bind-dialog ba-bind-dialog","destroy-on-close":!0,"close-on-click-modal":!1,width:"30%"},{footer:r(()=>[w("div",{style:K("width: calc(100% - 20px)")},[n(d,{onClick:o[27]||(o[27]=i=>e.dialog.bind.show=!1)},{default:r(()=>[f(u(t(l)("Cancel")),1)]),_:1}),q((p(),b(d,{loading:e.dialog.submitLoading,onClick:o[28]||(o[28]=i=>N(h.value)),type:"primary"},{default:r(()=>[f(u(t(l)("user.account.profile.bind")),1)]),_:1},8,["loading"])),[[P]])],4)]),default:r(()=>[n(L,{model:e.dialog.bind.form,rules:e.dialog.bind.rules,"label-position":"top",ref_key:"bindFormRef",ref:h,onKeyup:o[26]||(o[26]=F(i=>N(h.value),["enter"]))},{default:r(()=>[e.dialog.verification.accountVerificationToken?V("",!0):(p(),b(c,{key:0,label:t(l)("user.account.profile.Account password verification"),type:"password",modelValue:e.dialog.bind.form.password,"onUpdate:modelValue":o[21]||(o[21]=i=>e.dialog.bind.form.password=i),prop:"password","input-attr":{"show-password":!0},placeholder:a.$t("Please input field",{field:a.$t("user.account.profile.password")})},null,8,["label","modelValue","placeholder"])),e.dialog.type=="email"?(p(),b(c,{key:1,label:t(l)("user.account.profile.New "+e.dialog.type),type:"string",modelValue:e.dialog.bind.form.email,"onUpdate:modelValue":o[22]||(o[22]=i=>e.dialog.bind.form.email=i),prop:"email",placeholder:a.$t("Please input field",{field:t(l)("user.account.profile.New "+e.dialog.type)})},null,8,["label","modelValue","placeholder"])):V("",!0),e.dialog.type=="mobile"?(p(),b(c,{key:2,label:t(l)("user.account.profile.New "+e.dialog.type),type:"string",modelValue:e.dialog.bind.form.mobile,"onUpdate:modelValue":o[23]||(o[23]=i=>e.dialog.bind.form.mobile=i),prop:"mobile",placeholder:a.$t("Please input field",{field:t(l)("user.account.profile.New "+e.dialog.type)})},null,8,["label","modelValue","placeholder"])):V("",!0),n(v,{label:e.dialog.type=="email"?t(l)("user.account.profile.Mail verification"):t(l)("user.account.profile.SMS verification"),prop:"captcha"},{default:r(()=>[n(A,{class:"w100",gutter:10},{default:r(()=>[n(k,{span:18},{default:r(()=>[n(m,{modelValue:e.dialog.bind.form.captcha,"onUpdate:modelValue":o[24]||(o[24]=i=>e.dialog.bind.form.captcha=i),placeholder:t(l)("Please input field",{field:t(l)("user.account.profile.Verification Code")}),autocomplete:"off"},null,8,["modelValue","placeholder"])]),_:1}),n(k,{class:"captcha-box",span:6},{default:r(()=>[n(d,{onClick:o[25]||(o[25]=i=>Q(h.value)),loading:e.dialog.sendCaptchaLoading,disabled:!(e.dialog.codeSendCountdown<=0),type:"primary"},{default:r(()=>[f(u(e.dialog.codeSendCountdown<=0?t(l)("user.account.profile.send"):e.dialog.codeSendCountdown+t(l)("user.account.profile.seconds")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});const Le=G(ge,[["__scopeId","data-v-a2c6aee8"]]);export{Le as default};
