import{defineComponent as $,reactive as y,ref as D,onMounted as N,resolveComponent as m,resolveDirective as R,openBlock as u,createElementBlock as p,createVNode as i,withCtx as l,createElementVNode as o,withKeys as U,createTextVNode as k,toDisplayString as d,unref as S,withDirectives as q,Fragment as B,renderList as E,createCommentVNode as K,pushScopeId as j,popScopeId as A}from"vue";import{c as w,b as G,v as M,ai as H,q as J,m as C,r as O,_ as Q}from"./index-89e26330.js";import{F as W}from"./index-39d73c69.js";import"vue-i18n";import"vue-router";import"pinia";import"vue-demi";import"element-plus";import"./index-0a827c2c.js";import"./controllerUrls-941681c3.js";import"./index-d3b20950.js";const z="/api/carmi/";function X(n){return w({url:z+"index",method:"post",data:n})}function Y(n,e){return w({url:z+"list",method:"GET",params:{page:n,limit:e}})}const I=n=>(j("data-v-9fb98235"),n=n(),A(),n),Z={class:"user-views"},ee=I(()=>o("div",{class:"card-header"},[o("span",null,"卡密充值"),o("span",{class:"right-title"})],-1)),te={class:"change-password"},oe=I(()=>o("div",{class:"card-header"},[o("span",null,"充值记录"),o("span",{class:"right-title"})],-1)),ae={class:"logs"},re={class:"log-title"},se={class:"log-after"},ne={class:"log-after"},ie={class:"log-change-time"},le={key:0,class:"log-footer"},de=$({__name:"carmi",setup(n){const e=y({carmi:[],currentPage:1,total:0,pageSize:10,pageLoading:!0}),f=G(),_=D(),a=y({formSubmitLoading:!1,form:{key:"",uid:f.$state.id},rules:{key:{require:!0,message:"请输入卡密",trigger:"blur"}}}),h=t=>{t&&t.validate(r=>{r&&(a.formSubmitLoading=!0,X(a.form).then(c=>{a.formSubmitLoading=!1,c.code==1?(a.form.key="",J().then(g=>{g.data.userInfo.refreshToken=f.refreshToken,f.dataFill(g.data.userInfo)}),C.success(c.msg),O.push({name:"account/overview"})):C.error("卡密充值失败")}).catch(()=>{a.formSubmitLoading=!1}))})},L=t=>{e.pageSize=t,v()},x=t=>{e.currentPage=t,v()},v=()=>{Y(e.currentPage,e.pageSize).then(t=>{e.pageLoading=!1,e.carmi=t.data.list,e.total=t.data.total})};return N(()=>{v()}),(t,r)=>{const c=m("el-button"),g=m("el-form-item"),V=m("el-form"),b=m("el-card"),F=m("el-pagination"),P=R("loading");return u(),p("div",Z,[i(b,{class:"user-views-card",shadow:"hover"},{header:l(()=>[ee]),default:l(()=>[o("div",te,[i(V,{model:a.form,rules:a.rules,"label-position":"top",ref_key:"formRef",ref:_,onKeyup:r[3]||(r[3]=U(s=>h(_.value),["enter"]))},{default:l(()=>[i(W,{label:"",type:"string",modelValue:a.form.key,"onUpdate:modelValue":r[0]||(r[0]=s=>a.form.key=s),placeholder:"请输入卡密号码",prop:"key"},null,8,["modelValue"]),i(g,{class:"submit-buttons"},{default:l(()=>[i(c,{type:"primary",loading:a.formSubmitLoading,onClick:r[1]||(r[1]=s=>h(_.value))},{default:l(()=>[k(d(t.$t("Submit")),1)]),_:1},8,["loading"]),i(c,{onClick:r[2]||(r[2]=s=>S(M)(_.value))},{default:l(()=>[k(d(t.$t("Reset")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),_:1}),i(b,{class:"user-views-card",shadow:"hover"},{header:l(()=>[oe]),default:l(()=>[q((u(),p("div",ae,[(u(!0),p(B,null,E(e.carmi,(s,T)=>(u(),p("div",{class:"log-item",key:T},[o("div",re,"卡密号码："+d(s.key),1),o("div",se,"聊天次数："+d(s.num),1),o("div",ne,"有效天数："+d(s.day),1),o("div",ie,"充值时间："+d(S(H)(s.update_time)),1)]))),128))])),[[P,e.pageLoading]]),e.total>0?(u(),p("div",le,[i(F,{currentPage:e.currentPage,"page-size":e.pageSize,"page-sizes":[10,20,50,100],background:"",layout:"sizes, ->, prev, pager, next, jumper",total:e.total,onSizeChange:L,onCurrentChange:x},null,8,["currentPage","page-size","total"])])):K("",!0)]),_:1})])}}});const ke=Q(de,[["__scopeId","data-v-9fb98235"]]);export{ke as default};
