import{d as re,$ as le,q as ne,u as se,H as F,r as R,X as ie,o as de,a7 as ue,a8 as B,a9 as fe,Y as w,b as t,j as s,p as ce,e as f,a1 as D,f as c,g as K,a,c as h,N as j,x as y,a2 as me,h as _,i as C,M as A,k as pe,aa as ge,ab as ve,ac as we,ad as _e,ae as H,af as X,_ as be}from"./index-9250cf41.js";import{u as he}from"./memberCenter-56f43a26.js";import{b as m,v as ye}from"./validate-d30190a1.js";import{l as Ce,L as Ve}from"./loginFooter-2e60c17c.js";import{u as ke}from"./menu-83125494.js";import{h as ze}from"./router-c56b232f.js";const Le={class:"login chat-login"},xe={key:0},Fe={key:0,class:"login-box"},Pe=["src"],Se={key:3,class:"form-footer"},Re={key:1,class:"retrieve-password-form"},Te=re({__name:"login",setup(Ie){let P=ke(),T;const{t:n}=le(),Y=ce();pe();const V=ne(),I=se(),U=he(),b=F(),k=F(),e=R({form:{tab:"login",email:"",mobile:"",username:"",password:"",captcha:"",keep:!1,captchaId:D(),registerType:"mobile"},formLoading:!1,showCaptcha:!1,showRetrievePasswordDialog:!1,retrievePasswordForm:{type:"mobile",account:"",captcha:"",password:""},dialogWidth:30,accountVerificationType:[],codeSendCountdown:0,submitRetrieveLoading:!1,sendCaptchaLoading:!1});let p=F(!1),z=F("用户登录");ie(()=>{p.value?z.value="忘记密码":e.form.tab=="register"?z.value="用户注册":z.value="用户登录"});const G=R({email:[m({name:"required",title:n("email")}),m({name:"email",title:n("email")})],username:[m({name:"required",title:n("User name")}),{validator:(l,o,i)=>{if(e.form.tab=="register")return ye(l,o,i);i()},trigger:"blur"}],password:[m({name:"required",title:n("password")}),m({name:"password"})],mobile:[m({name:"required",title:n("mobile")}),m({name:"mobile"})]}),J=R({account:[m({name:"required",title:n("Account name")})],captcha:[m({name:"required",title:n("Verification Code")})],password:[m({name:"required",title:n("password")}),m({name:"password"})]}),$=()=>{let l=document.documentElement.clientWidth,o=30;l<=790?o=92:l<=910?o=56:l<=1260&&(o=46),e.dialogWidth=o},L=()=>{e.form.captcha="",e.form.captchaId=D()},q=(l=void 0)=>{l.validate(o=>{o?(e.formLoading=!0,e.form.tab=="register"&&e.form.username==""&&(e.form.username="user"+ge(1e3,9999).toString()),B("post",e.form).then(i=>(console.log(),P.userLogin=!1,e.formLoading=!1,V.dataFill(i.data.userInfo),U.state.viewRoutes.length==0&&ve().then(d=>{d.data.userInfo.refreshToken=V.refreshToken,V.dataFill(d.data.userInfo),d.data.menus&&ze(d.data.menus)}),!1)).catch(()=>{e.formLoading=!1,L()})):L()})},M=(l=void 0)=>{l.validate(o=>{o&&(e.submitRetrieveLoading=!0,we(e.retrievePasswordForm).then(i=>{e.submitRetrieveLoading=!1,i.code==1&&(e.showRetrievePasswordDialog=!1,L(),S(),_e(l))}).catch(()=>{e.submitRetrieveLoading=!1}))})},O=(l=void 0)=>{e.codeSendCountdown>0||l.validateField([e.form.registerType,"username","password"]).then(o=>{o&&(e.sendCaptchaLoading=!0,(e.form.registerType=="email"?H:X)(e.form[e.form.registerType],"user_register").then(u=>{u.code==1&&E(60)}).finally(()=>{e.sendCaptchaLoading=!1}))})},Q=(l=void 0)=>{e.codeSendCountdown>0||l.validateField("account").then(o=>{o&&(e.sendCaptchaLoading=!0,(e.retrievePasswordForm.type=="email"?H:X)(e.retrievePasswordForm.account,"user_retrieve_pwd").then(u=>{u.code==1&&E(60)}).finally(()=>{e.sendCaptchaLoading=!1}))})},N=(l=void 0,o)=>{e.form.tab=o,o=="register"&&(e.form.username=""),l&&l.clearValidate()},E=l=>{e.codeSendCountdown=l,T=setInterval(()=>{e.codeSendCountdown--,e.codeSendCountdown<=0&&S()},1e3)},S=()=>{e.codeSendCountdown=0,clearInterval(T)};return de(async()=>{await Ce()||($(),ue(window,"resize",$),V.$state.id==0&&B("get").then(l=>{e.accountVerificationType=l.data.accountVerificationType,e.retrievePasswordForm.type=l.data.accountVerificationType.length>0?l.data.accountVerificationType[0]:""}),Y.query.type=="register"&&(e.form.tab="register"))}),fe(()=>{e.codeSendCountdown=0,S()}),(l,o)=>{const i=f("Icon"),u=f("el-input"),d=f("el-form-item"),g=f("el-col"),x=f("el-row"),v=f("el-button"),Z=f("el-checkbox"),W=f("el-form"),ee=f("el-alert"),oe=f("el-main"),ae=f("el-container"),te=f("el-dialog");return c(),w(te,{modelValue:s(P).userLogin,"onUpdate:modelValue":o[18]||(o[18]=r=>s(P).userLogin=r),title:s(z),width:e.dialogWidth+"%",center:"","align-center":"",draggable:"",class:"user-login-header"},{default:t(()=>[K("div",Le,[a(ae,{class:"is-vertical"},{default:t(()=>[a(oe,{class:"frontend-footer-brother"},{default:t(()=>[a(x,{justify:"center"},{default:t(()=>[a(g,{span:16,xs:24},{default:t(()=>[s(p)?(c(),h("div",Re,[a(W,{ref_key:"retrieveFormRef",ref:k,onKeyup:o[17]||(o[17]=j(r=>M(k.value),["enter"])),rules:J,model:e.retrievePasswordForm,"label-width":100},{default:t(()=>[a(d,{prop:"account","label-width":"0"},{default:t(()=>[a(u,{modelValue:e.retrievePasswordForm.account,"onUpdate:modelValue":o[11]||(o[11]=r=>e.retrievePasswordForm.account=r),placeholder:s(n)("Please input field",{field:e.retrievePasswordForm.type=="email"?s(n)("email"):s(n)("mobile")}),size:"large",clearable:!0},{prefix:t(()=>[a(i,{name:"fa fa-user",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue","placeholder"])]),_:1}),a(d,{prop:"password","label-width":"0"},{default:t(()=>[a(u,{modelValue:e.retrievePasswordForm.password,"onUpdate:modelValue":o[12]||(o[12]=r=>e.retrievePasswordForm.password=r),placeholder:s(n)("Please input field",{field:s(n)("New password")}),"show-password":"",size:"large"},{prefix:t(()=>[a(i,{name:"fa fa-unlock-alt",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue","placeholder"])]),_:1}),a(d,{prop:"captcha","label-width":"0"},{default:t(()=>[a(x,{class:"w100"},{default:t(()=>[a(g,{span:16},{default:t(()=>[a(u,{modelValue:e.retrievePasswordForm.captcha,"onUpdate:modelValue":o[13]||(o[13]=r=>e.retrievePasswordForm.captcha=r),placeholder:s(n)("Please input field",{field:s(n)("Verification Code")}),autocomplete:"off",size:"large"},{prefix:t(()=>[a(i,{name:"fa fa-ellipsis-h",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue","placeholder"])]),_:1}),a(g,{class:"captcha-box",span:8},{default:t(()=>[a(v,{onClick:o[14]||(o[14]=r=>Q(k.value)),loading:e.sendCaptchaLoading,disabled:!(e.codeSendCountdown<=0),type:"primary"},{default:t(()=>[_(C(e.codeSendCountdown<=0?s(n)("send"):e.codeSendCountdown+s(n)("seconds")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),a(d,{class:"form-buttons","label-width":"0"},{default:t(()=>[a(v,{class:"login-btn",onClick:o[15]||(o[15]=r=>M(k.value)),loading:e.submitRetrieveLoading,round:"",type:"primary",size:"large"},{default:t(()=>[_(C(s(n)("second")),1)]),_:1},8,["loading"]),a(v,{onClick:o[16]||(o[16]=r=>A(p)?p.value=!1:p=!1),round:"",plain:"",type:"info",size:"large"},{default:t(()=>[_(" 返回登录 ")]),_:1})]),_:1})]),_:1},8,["rules","model"])])):(c(),h("div",xe,[s(U).state.open?(c(),h("div",Fe,[a(W,{ref_key:"formRef",ref:b,onKeyup:o[10]||(o[10]=j(r=>q(b.value),["enter"])),rules:G,model:e.form},{default:t(()=>[e.form.registerType=="mobile"?(c(),w(d,{key:0,prop:"mobile"},{default:t(()=>[a(u,{modelValue:e.form.mobile,"onUpdate:modelValue":o[0]||(o[0]=r=>e.form.mobile=r),placeholder:"请输入手机号",clearable:!0,size:"large"},{prefix:t(()=>[a(i,{name:"fa fa-tablet",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1})):y("",!0),a(d,{prop:"password"},{default:t(()=>[a(u,{modelValue:e.form.password,"onUpdate:modelValue":o[1]||(o[1]=r=>e.form.password=r),placeholder:"请输入用户密码",type:"password","show-password":"",size:"large"},{prefix:t(()=>[a(i,{name:"fa fa-unlock-alt",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1}),e.form.tab=="login"&&s(I).loginCheck=="true"?(c(),w(d,{key:1,prop:"captcha"},{default:t(()=>[a(x,{class:"w100"},{default:t(()=>[a(g,{span:16},{default:t(()=>[a(u,{modelValue:e.form.captcha,"onUpdate:modelValue":o[2]||(o[2]=r=>e.form.captcha=r),clearable:"",autocomplete:"off",placeholder:"请输入验证码",size:"large"},{prefix:t(()=>[a(i,{name:"fa fa-ellipsis-h",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1}),a(g,{class:"captcha-box",span:8},{default:t(()=>[K("img",{onClick:L,class:"captcha-img",src:s(me)()+"&id="+e.form.captchaId,alt:""},null,8,Pe)]),_:1})]),_:1})]),_:1})):y("",!0),e.form.tab=="register"&&s(I).openCheck=="true"?(c(),w(d,{key:2,prop:"captcha"},{default:t(()=>[a(x,{class:"w100"},{default:t(()=>[a(g,{span:16},{default:t(()=>[a(u,{size:"large",modelValue:e.form.captcha,"onUpdate:modelValue":o[3]||(o[3]=r=>e.form.captcha=r),placeholder:"请输入验证码",autocomplete:"off"},{prefix:t(()=>[a(i,{name:"fa fa-ellipsis-h",size:"16",color:"var(--el-input-icon-color)"})]),_:1},8,["modelValue"])]),_:1}),a(g,{class:"captcha-box",span:8},{default:t(()=>[a(v,{size:"large",onClick:o[4]||(o[4]=r=>O(b.value)),loading:e.sendCaptchaLoading,disabled:!(e.codeSendCountdown<=0),type:"primary"},{default:t(()=>[_(C(e.codeSendCountdown<=0?"发送":e.codeSendCountdown+"秒"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})):y("",!0),e.form.tab!="register"?(c(),h("div",Se,[a(Z,{modelValue:e.form.keep,"onUpdate:modelValue":o[5]||(o[5]=r=>e.form.keep=r),label:"记住我",size:"default"},null,8,["modelValue"]),e.accountVerificationType.length>0?(c(),h("div",{key:0,onClick:o[6]||(o[6]=r=>A(p)?p.value=!0:p=!0),class:"forgot-password"},C(s(n)("Forgot your password?")),1)):y("",!0)])):y("",!0),a(d,{class:"form-buttons"},{default:t(()=>[a(v,{class:"login-btn",onClick:o[7]||(o[7]=r=>q(b.value)),loading:e.formLoading,round:"",type:"primary",size:"large"},{default:t(()=>[_(C(s(n)(e.form.tab)),1)]),_:1},8,["loading"]),e.form.tab=="register"?(c(),w(v,{key:0,onClick:o[8]||(o[8]=r=>N(b.value,"login")),round:"",plain:"",type:"info",size:"large"},{default:t(()=>[_("回到登录")]),_:1})):(c(),w(v,{key:1,onClick:o[9]||(o[9]=r=>N(b.value,"register")),round:"",plain:"",type:"info",size:"large"},{default:t(()=>[_(" 还没有账户？点击注册 ")]),_:1}))]),_:1}),a(Ve)]),_:1},8,["rules","model"])])):(c(),w(ee,{key:1,center:!0,title:l.$t("Member center disabled"),type:"error"},null,8,["title"]))]))]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["modelValue","title","width"])}}});const We=be(Te,[["__scopeId","data-v-a9db1f56"]]);export{We as default};
