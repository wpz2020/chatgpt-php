import{c as i}from"./chat-9567bdf0.js";import{h}from"./chat-57a81274.js";import{b as f}from"./index-89e26330.js";let C=async(l,g)=>{let t=f().getUserInfo(),m=i.getNowChatId();if(l==null||l=="")return!1;if(t.num<=0){let e="";return t.id==0?e="聊天次数不足,请登录账号":e="聊天次数不足,请开通会员",i.updateChat(m,{role:"robot",msg:e,time:new Date().getTime(),size:10,isfinish:!1}),!1}g=="first"&&(i.updateChat(m,{role:"user",msg:l,time:new Date().getTime(),size:10,isfinish:!1}),i.updateChat(m,{role:"robot",msg:"思考中...",time:new Date().getTime(),size:10,isfinish:!1})),l="";let s=i.getOneChat(m),n=[],o=0;s.msglist.length>10&&(o=s.msglist.length-11);for(let e=0;e<s.msglist.length-1;e++){if(e<o)continue;let a=s.msglist[e].role;a=="robot"?a="assistant":a="user",n.push({role:a,content:s.msglist[e].msg})}let r=t.token;r==""&&(r=t.isyouke),h({message:n,uid:t.id,username:t.username,num:t.num-1,token:r,cate:"chat"});let u=t.num-1;f().setNum(u)};export{C as s};
