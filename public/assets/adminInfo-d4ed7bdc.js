import{defineComponent as K,ref as J,reactive as P,resolveComponent as r,resolveDirective as Q,openBlock as g,createElementBlock as F,createVNode as n,withCtx as i,createElementVNode as u,toDisplayString as p,unref as t,createBlock as w,withKeys as V,withModifiers as U,createTextVNode as k,withDirectives as W,Fragment as X,renderList as Y}from"vue";import{useI18n as Z}from"vue-i18n";import{c as y,h as ee,i as z,v as oe,ai as ne,af as ae,_ as te}from"./index-89e26330.js";import{c as le}from"./controllerUrls-941681c3.js";import{ElForm as ie}from"element-plus";import{b}from"./validate-e09b6b50.js";import"vue-router";import"pinia";import"vue-demi";const S="/admin/routine.AdminInfo/",x=new Map([["index",S+"index"],["edit",S+"edit"],["log",le+"index"]]);function de(){return y({url:x.get("index"),method:"get"})}function re(_={}){return y({url:x.get("log"),method:"get",params:_})}function D(_){return y({url:x.get("edit"),method:"post",data:_},{showSuccessMessage:!0})}const me={class:"default-main"},se={class:"admin-info"},ue={class:"image-slot"},fe={class:"admin-info-base"},pe={class:"admin-nickname"},ce={class:"admin-other"},ge={class:"admin-info-form"},_e=K({name:"routine/adminInfo"}),Ie=K({..._e,setup(_){const{t:a}=Z(),c=J(),I=ee(),e=P({adminInfo:{},formKey:z(),buttonLoading:!1,log:[],logFilter:{limit:12},logCurrentPage:1,logPageSize:12,logTotal:100,logLoading:!0});de().then(d=>{e.adminInfo=d.data.info,e.formKey=z(),e.logFilter.search=[{field:"admin_id",val:d.data.info.id,operator:"="}],v()});const v=()=>{re(e.logFilter).then(d=>{e.log=d.data.list,e.logTotal=d.data.total,e.logLoading=!1}).catch(()=>{e.logLoading=!1})},$=d=>{e.logPageSize=d,e.logFilter.limit=d,v()},A=d=>{e.logCurrentPage=d,e.logFilter.page=d,v()},T=P({nickname:[b({name:"required",title:a("routine.adminInfo.User nickname")})],email:[b({name:"email",title:a("routine.adminInfo.e-mail address")})],mobile:[b({name:"mobile",message:a("Please enter the correct field",{field:a("routine.adminInfo.phone number")})})],password:[b({name:"password"})]}),B=d=>{let o=new FormData;o.append("file",d.raw),ae(o).then(m=>{m.code==1&&D({id:e.adminInfo.id,avatar:m.data.file.url}).then(()=>{I.dataFill({...I.$state,avatar:m.data.file.full_url}),e.adminInfo.avatar=m.data.file.full_url})})},h=d=>{d&&d.validate(o=>{if(o){let m={...e.adminInfo};delete m.lastlogintime,delete m.username,delete m.avatar,e.buttonLoading=!0,D(m).then(()=>{I.dataFill({...I.$state,nickname:e.adminInfo.nickname}),e.buttonLoading=!1}).catch(()=>{e.buttonLoading=!1})}})};return(d,o)=>{const m=r("Icon"),N=r("el-image"),R=r("el-upload"),f=r("el-input"),s=r("el-form-item"),C=r("el-button"),L=r("el-col"),j=r("el-timeline-item"),M=r("el-timeline"),E=r("el-pagination"),q=r("el-card"),O=r("el-row"),G=Q("loading");return g(),F("div",me,[n(O,{gutter:30},{default:i(()=>[n(L,{class:"lg-mb-20",xs:24,sm:24,md:24,lg:10},{default:i(()=>[u("div",se,[n(R,{class:"avatar-uploader",action:"","show-file-list":!1,onChange:B,"auto-upload":!1,accept:"image/gif, image/jpg, image/jpeg, image/bmp, image/png, image/webp"},{default:i(()=>[n(N,{src:e.adminInfo.avatar,class:"avatar"},{error:i(()=>[u("div",ue,[n(m,{size:"30",color:"#c0c4cc",name:"el-icon-Picture"})])]),_:1},8,["src"])]),_:1}),u("div",fe,[u("div",pe,p(e.adminInfo.nickname),1),u("div",ce,[u("div",null,p(t(a)("routine.adminInfo.Last logged in on"))+" "+p(e.adminInfo.lastlogintime),1)])]),u("div",ge,[(g(),w(t(ie),{onKeyup:o[10]||(o[10]=V(l=>h(c.value),["enter"])),key:e.formKey,"label-position":"top",rules:T,ref_key:"formRef",ref:c,model:e.adminInfo},{default:i(()=>[n(s,{label:t(a)("routine.adminInfo.user name")},{default:i(()=>[n(f,{disabled:"",modelValue:e.adminInfo.username,"onUpdate:modelValue":o[0]||(o[0]=l=>e.adminInfo.username=l)},null,8,["modelValue"])]),_:1},8,["label"]),n(s,{label:t(a)("routine.adminInfo.User nickname"),prop:"nickname"},{default:i(()=>[n(f,{placeholder:t(a)("routine.adminInfo.Please enter a nickname"),modelValue:e.adminInfo.nickname,"onUpdate:modelValue":o[1]||(o[1]=l=>e.adminInfo.nickname=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(s,{label:t(a)("routine.adminInfo.e-mail address"),prop:"email"},{default:i(()=>[n(f,{placeholder:t(a)("Please input field",{field:t(a)("routine.adminInfo.e-mail address")}),modelValue:e.adminInfo.email,"onUpdate:modelValue":o[2]||(o[2]=l=>e.adminInfo.email=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(s,{label:t(a)("routine.adminInfo.phone number"),prop:"mobile"},{default:i(()=>[n(f,{placeholder:t(a)("Please input field",{field:t(a)("routine.adminInfo.phone number")}),modelValue:e.adminInfo.mobile,"onUpdate:modelValue":o[3]||(o[3]=l=>e.adminInfo.mobile=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(s,{label:t(a)("routine.adminInfo.autograph"),prop:"motto"},{default:i(()=>[n(f,{onKeyup:[o[4]||(o[4]=V(U(()=>{},["stop"]),["enter"])),o[5]||(o[5]=V(U(l=>h(c.value),["ctrl"]),["enter"]))],placeholder:t(a)("routine.adminInfo.This guy is lazy and doesn write anything"),type:"textarea",modelValue:e.adminInfo.motto,"onUpdate:modelValue":o[6]||(o[6]=l=>e.adminInfo.motto=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(s,{label:t(a)("routine.adminInfo.New password"),prop:"password"},{default:i(()=>[n(f,{type:"password",placeholder:t(a)("routine.adminInfo.Please leave blank if not modified"),modelValue:e.adminInfo.password,"onUpdate:modelValue":o[7]||(o[7]=l=>e.adminInfo.password=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),n(s,null,{default:i(()=>[n(C,{type:"primary",loading:e.buttonLoading,onClick:o[8]||(o[8]=l=>h(c.value))},{default:i(()=>[k(p(t(a)("routine.adminInfo.Save changes")),1)]),_:1},8,["loading"]),n(C,{onClick:o[9]||(o[9]=l=>t(oe)(c.value))},{default:i(()=>[k(p(t(a)("Reset")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"]))])])]),_:1}),W((g(),w(L,{xs:24,sm:24,md:24,lg:12},{default:i(()=>[n(q,{header:t(a)("routine.adminInfo.Operation log"),shadow:"never"},{default:i(()=>[n(M,null,{default:i(()=>[(g(!0),F(X,null,Y(e.log,(l,H)=>(g(),w(j,{key:H,size:"large",timestamp:t(ne)(l.createtime)},{default:i(()=>[k(p(l.title),1)]),_:2},1032,["timestamp"]))),128))]),_:1}),n(E,{currentPage:e.logCurrentPage,"page-size":e.logPageSize,"page-sizes":[12,22,52,100],background:"",layout:"prev, next, jumper",total:e.logTotal,onSizeChange:$,onCurrentChange:A},null,8,["currentPage","page-size","total"])]),_:1},8,["header"])]),_:1})),[[G,e.logLoading]])]),_:1})])}}});const Le=te(Ie,[["__scopeId","data-v-b17ba511"]]);export{Le as default};
